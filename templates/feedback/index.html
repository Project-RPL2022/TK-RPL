{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}

<div>
  <form id="login-form">
    {% csrf_token %}
    <div class="flex justify-center">
      <div>
        <div class="form-input">
          <div>
            <label for="title" className="icon">
              <p>title</p>
            </label>
            <input
              type="text"
              name="title"
              id="title"
              autocomplete="off"
              placeholder="Title"
            />
          </div>
        </div>
        <div class="form-input">
          <div>
            <label for="description" className="icon">
              <p>password</p>
            </label>
            <input
              type="text"
              name="description"
              id="description"
              autocomplete="off"
              placeholder="Description"
            />
          </div>
        </div>
      </div>
    </div>
    <div class="mt-3">
      <button type="button" id="signin" onclick="onSubmit()">
        SUBMIT
      </button>
    </div>
  </form>
</div>
<script>
  function onSubmit() {
    const title = document.getElementById("title").value;
    const description = document.getElementById("description").value;
    const csrf = getCookie("csrftoken");
    $.ajax({
      url: "/api/feedback",
      type: "POST",
      dataType: "json",
      data: {
        title: title,
        description: description,
        csrfmiddlewaretoken: csrf,
      },
      success: (data, status) => {
        console.log("success: " + data);
        if (data.error) {
          const error = $("<p></p>")
            .addClass("error-message fade mb-3")
            .text(data.error);
          $("#login-form").prepend(error);
        } else {
          alert("success");
          // window.location.replace("");
        }
      },
      error: (error) => {
        console.log(error);
      },
    });
  }

  function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != "") {
      var cookies = document.cookie.split(";");
      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) == name + "=") {
          cookieValue = decodeURIComponent(
            cookie.substring(name.length + 1)
          );
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

{% endblock %}